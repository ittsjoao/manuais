
generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Departamento {
  id        Int        @id @default(autoincrement())
  nome      String
  slug      String     @unique
  descricao String?
  ordem     Int        @default(0)
  createdAt DateTime   @default(now()) @map("criado_em")
  updatedAt DateTime   @updatedAt @map("atualizado_em")
  programas DepartamentoPrograma[]

  @@map("departamento")
}

model Programa {
  id             Int              @id @default(autoincrement())
  nome           String
  url            String?
  ordem          Int              @default(0)
  createdAt      DateTime         @default(now()) @map("criado_em")
  updatedAt      DateTime         @updatedAt @map("atualizado_em")
  departamentos  DepartamentoPrograma[]
  manuais        ProgramaManual[]

  @@map("programa")
}

// Tabela de junção para relação many-to-many entre Departamento e Programa
model DepartamentoPrograma {
  id             Int          @id @default(autoincrement())
  departamentoId Int          @map("departamento_id")
  programaId     Int          @map("programa_id")
  departamento   Departamento @relation(fields: [departamentoId], references: [id], onDelete: Cascade)
  programa       Programa     @relation(fields: [programaId], references: [id], onDelete: Cascade)

  @@unique([departamentoId, programaId])
  @@map("departamento_programa")
}

model Manual {
  id        Int              @id @default(autoincrement())
  titulo    String
  conteudo  String
  tags      String[]         @default([])
  createdAt DateTime         @default(now()) @map("criado_em")
  updatedAt DateTime         @updatedAt @map("atualizado_em")
  programas ProgramaManual[]

  @@map("manual")
}

model ProgramaManual {
  id         Int      @id @default(autoincrement())
  programaId Int      @map("programa_id")
  manualId   Int      @map("manual_id")
  ordem      Int      @default(0)
  programa   Programa @relation(fields: [programaId], references: [id], onDelete: Cascade)
  manual     Manual   @relation(fields: [manualId], references: [id], onDelete: Cascade)

  @@unique([programaId, manualId])
  @@map("programa_manual")
}

model User {
  id            String    @id
  name          String
  email         String    @unique
  emailVerified Boolean   @default(false)
  image         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  sessions      Session[]
  accounts      Account[]

  @@map("user")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([userId])
  @@map("account")
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier])
  @@map("verification")
}
